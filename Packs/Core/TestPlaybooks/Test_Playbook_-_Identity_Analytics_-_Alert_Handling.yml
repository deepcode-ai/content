id: Test Playbook - Identity Analytics - Alert Handling
version: -1
name: Test Playbook - Identity Analytics - Alert Handling
description: |-
  This playbook tests the ‘Identity Analytics - Alert Handling' playbook which is part of the ‘Core’ pack.

  The following tests are conducted in the playbook:
  1-Confirm that alert fields were populated correctly by the custom output mapping rules and the ‘setalert’ automation.
  2- Ensure that the context data is correctly extracted.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: db7af57a-9e72-468a-8ceb-eb144f841b6c
    type: start
    task:
      id: db7af57a-9e72-468a-8ceb-eb144f841b6c
      version: -1
      name: ""
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "1"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": -530
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "1":
    id: "1"
    taskid: 208ea0cc-d48e-4e60-87c3-754d9d560549
    type: regular
    task:
      id: 208ea0cc-d48e-4e60-87c3-754d9d560549
      version: -1
      name: Delete Context
      description: |-
        Delete field from context.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: DeleteContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "2"
    scriptarguments:
      all:
        simple: "yes"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": -400
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "2":
    id: "2"
    taskid: 7b26f247-4793-4491-8200-d1cd9683af62
    type: regular
    task:
      id: 7b26f247-4793-4491-8200-d1cd9683af62
      version: -1
      name: Get Available Users - AD
      description: Retrieves detailed information about a user account. The user can be specified by name, email address, or as an Active Directory Distinguished Name (DN). If no filter is specified, all users are returned.
      script: '|||ad-get-user'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "3"
    scriptarguments:
      ignore-outputs:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": -240
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "3":
    id: "3"
    taskid: b89c2791-18c8-4de4-86ce-cad7ebe155ea
    type: condition
    task:
      id: b89c2791-18c8-4de4-86ce-cad7ebe155ea
      version: -1
      name: AD Users Retrieved?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "309"
      "yes":
      - "304"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: ActiveDirectory.Users.name
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": -80
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "10":
    id: "10"
    taskid: 35fca0ce-85f2-4754-89dc-eaf4e85f0b8f
    type: title
    task:
      id: 35fca0ce-85f2-4754-89dc-eaf4e85f0b8f
      version: -1
      name: Start Tests
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "13"
      - "269"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "13":
    id: "13"
    taskid: a219a2f2-0e18-49ef-85c2-489dccc40798
    type: title
    task:
      id: a219a2f2-0e18-49ef-85c2-489dccc40798
      version: -1
      name: Check Context Data
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "70"
      - "302"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 1410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "70":
    id: "70"
    taskid: 4011a1d3-8d58-4c87-86e7-b9289280d429
    type: condition
    task:
      id: 4011a1d3-8d58-4c87-86e7-b9289280d429
      version: -1
      name: Verify Number Of Related Alerts
      description: Verify that the ‘NumOfRelatedAlerts’ context key was extracted correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "71"
      "yes":
      - "256"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: NumOfRelatedAlerts
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "71":
    id: "71"
    taskid: 4acb9c4c-b0b1-4d11-8504-eb6acf260ba6
    type: regular
    task:
      id: 4acb9c4c-b0b1-4d11-8504-eb6acf260ba6
      version: -1
      name: Verify Context Error - Number Of Related Alerts
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The 'NumOfRelatedAlerts' context key was not extracted properly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'key' input configuration was changed for the 'SetAndHandleEmpty' automation used in the 'Set Number of Related Alerts' task.
          3- The 'value' input configuration was changed for the 'SetAndHandleEmpty' automation used in the 'Set Number of Related Alerts' task.
          4- the 'Get entity alerts by MITRE tactics' playbook did not return any results.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "256":
    id: "256"
    taskid: 516a3a74-905b-4f9b-83aa-5c2944631b22
    type: title
    task:
      id: 516a3a74-905b-4f9b-83aa-5c2944631b22
      version: -1
      name: Done Verifying Context Data
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "306"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 690,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "265":
    id: "265"
    taskid: 77f4d88a-78f7-4992-8a5f-3c9c4e2ae6c0
    type: regular
    task:
      id: 77f4d88a-78f7-4992-8a5f-3c9c4e2ae6c0
      version: -1
      name: Set 'Username' To Alert Field
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      username:
        complex:
          root: ActiveDirectory.Users
          filters:
          - - operator: isNotEmpty
              left:
                value:
                  simple: ActiveDirectory.Users.name
                iscontext: true
          - - operator: isNotEmpty
              left:
                value:
                  simple: ActiveDirectory.Users.mail
                iscontext: true
              ignorecase: true
          accessor: name
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2260,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "266":
    id: "266"
    taskid: 0ca02a43-c537-4c4d-82e3-0ff7f1648a44
    type: playbook
    task:
      id: 0ca02a43-c537-4c4d-82e3-0ff7f1648a44
      version: -1
      name: Identity Analytics - Alert Handling - AD
      description: |-
        The `Identity Analytics - Alert Handling` playbook is designed to handle Identity Analytics alerts and executes the following:

        Analysis:
        - Enriches the IP and the account, providing additional context and information about these indicators.

        Verdict:
        - Determines the appropriate verdict based on the data collected from the enrichment phase.

        Investigation:
        - Checks for related XDR alerts to the user by Mitre tactics to identify malicious activity.
        - Checks for specific arguments for malicious usage from Okta using the 'Okta User Investigation' sub-playbook.
        - Checks for specific arguments for malicious usage from Azure using the 'Azure User Investigation' sub-playbook.

        Verdict Handling:
        - Handles malicious alerts by initiating appropriate response actions, including blocking malicious IP and revoking or clearing user's sessions.
        - Handles non-malicious alerts identified during the investigation.
      playbookName: Identity Analytics - Alert Handling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "310"
    scriptarguments:
      AutoContainment:
        simple: "False"
      AutoRemediation:
        simple: "False"
      AzureMfaFailedLogonThreshold:
        simple: "1"
      ClearUserSessions:
        simple: "False"
      FailedLogonThreshold:
        simple: "1"
      IAMRemediationType:
        simple: Revoke
      OktaSuspiciousEventsThreshold:
        simple: "1"
      RelatedAlertsThreshold:
        simple: "1"
      UserContainment:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 460,
          "y": 440
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "268":
    id: "268"
    taskid: 7aa53d32-657d-4fb4-8aa3-ac64a25c8ab7
    type: regular
    task:
      id: 7aa53d32-657d-4fb4-8aa3-ac64a25c8ab7
      version: -1
      name: Set 'IP.Address' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      key:
        simple: IP.Address
      value:
        simple: 8.8.8.8
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1870,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "269":
    id: "269"
    taskid: 97cb2eec-2fe3-4eae-81cf-24b019325092
    type: title
    task:
      id: 97cb2eec-2fe3-4eae-81cf-24b019325092
      version: -1
      name: Check Alert Field
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "270"
      - "272"
      - "274"
      - "276"
      - "278"
      - "280"
      - "282"
      - "284"
      - "286"
      - "288"
      - "290"
      - "300"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": 1410
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "270":
    id: "270"
    taskid: c6e07f4d-9d6d-462f-8035-85bb453cdaba
    type: condition
    task:
      id: c6e07f4d-9d6d-462f-8035-85bb453cdaba
      version: -1
      name: Verify Number Of Found Related Alerts
      description: Verify that the ‘numberoffoundrelatedalerts’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "271"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isExists
          left:
            value:
              simple: alert.numberoffoundrelatedalerts
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "271":
    id: "271"
    taskid: b5b5b919-7c1b-4e89-8cf3-42072a5b2ffb
    type: regular
    task:
      id: b5b5b919-7c1b-4e89-8cf3-42072a5b2ffb
      version: -1
      name: Verify Context Error - Number Of Found Related Alerts
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘numberoffoundrelatedalerts’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'key' input configuration was changed for the 'SetAndHandleEmpty' automation used in the 'Set Number of Related Alerts' task.
          3- The 'value' input configuration was changed for the 'SetAndHandleEmpty' automation used in the 'Set Number of Related Alerts' task.
          4- the 'Get entity alerts by MITRE tactics' playbook did not return any results.
          5- The mapping rule for the 'Number Of Found Related Alerts' alert field was removed.
          6- A change was made to the 'outputs' value for the 'Number Of Found Related Alerts' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -170,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "272":
    id: "272"
    taskid: fe34904a-e309-465d-8207-224e16481c45
    type: condition
    task:
      id: fe34904a-e309-465d-8207-224e16481c45
      version: -1
      name: Verify Alert Search Results
      description: Verify that the ‘alertsearchresults’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "273"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.alertsearchresults
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -570,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "273":
    id: "273"
    taskid: 807d59ca-2d07-4a53-8c84-408e80fcd061
    type: regular
    task:
      id: 807d59ca-2d07-4a53-8c84-408e80fcd061
      version: -1
      name: Verify Context Error - Alert Search Results
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘alertsearchresults’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- the 'Get entity alerts by MITRE tactics' playbook did not return any results.
          3- The mapping rule for the 'Alert Search Results' alert field was removed.
          4- A change was made to the 'outputs' value for the 'Alert Search Results' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -570,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "274":
    id: "274"
    taskid: 6dc7496a-e2ce-4205-8ac7-b5eddcfe8d87
    type: condition
    task:
      id: 6dc7496a-e2ce-4205-8ac7-b5eddcfe8d87
      version: -1
      name: Verify User Risk Level
      description: Verify that the ‘userrisklevel’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "275"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.userrisklevel
            iscontext: true
          right:
            value: {}
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -960,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "275":
    id: "275"
    taskid: ed82fa7d-5a65-43fd-86e6-edbd06d5bde4
    type: regular
    task:
      id: ed82fa7d-5a65-43fd-86e6-edbd06d5bde4
      version: -1
      name: Verify Context Error - User Risk Level
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘userrisklevel’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- the 'Get entity alerts by MITRE tactics' playbook did not return any results.
          3- The mapping rule for the 'User Risk Level' alert field was removed.
          4- A change was made to the 'outputs' value for the 'User Risk Level' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -960,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "276":
    id: "276"
    taskid: 9d7666fe-9973-4830-8db8-4085da8f0852
    type: condition
    task:
      id: 9d7666fe-9973-4830-8db8-4085da8f0852
      version: -1
      name: Verify Failed Logon Events
      description: Verify that the ‘failedlogonevents’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "277"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.failedlogonevents
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1350,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "277":
    id: "277"
    taskid: c2ad7c84-dc1f-4fa3-8d5c-057e5fd13015
    type: regular
    task:
      id: c2ad7c84-dc1f-4fa3-8d5c-057e5fd13015
      version: -1
      name: Verify Context Error - Failed Logon Events
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘failedlogonevents’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- the 'Azure - User Investigation' playbook did not return any results.
          3- The mapping rule for the 'Failed Logon Events' alert field was removed.
          4- A change was made to the 'outputs' value for the 'Failed Logon Events' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1350,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "278":
    id: "278"
    taskid: 5de64588-d447-491d-8803-8abc3ca4f96c
    type: condition
    task:
      id: 5de64588-d447-491d-8803-8abc3ca4f96c
      version: -1
      name: Verify Email
      description: Verify that the ‘email’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "279"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.email
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1740,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "279":
    id: "279"
    taskid: bf8bee67-73e0-4179-8290-be9c4769c904
    type: regular
    task:
      id: bf8bee67-73e0-4179-8290-be9c4769c904
      version: -1
      name: Verify Context Error - Email
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘email’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' and the 'Fetch cloud alert extra data' playbook did not return any results.
          3- The mapping rule for the 'Email' alert field was removed.
          4- A change was made to the 'outputs' value for the 'Email' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1740,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "280":
    id: "280"
    taskid: 414ed9cd-4daf-41b9-8189-b0fefb5114ae
    type: condition
    task:
      id: 414ed9cd-4daf-41b9-8189-b0fefb5114ae
      version: -1
      name: Verify Account Member Of
      description: Verify that the ‘accountmemberof’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "281"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.accountmemberof
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2140,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "281":
    id: "281"
    taskid: e1fa1df6-fb9a-4cb6-878e-5dd71875d7df
    type: regular
    task:
      id: e1fa1df6-fb9a-4cb6-878e-5dd71875d7df
      version: -1
      name: Verify Context Error - Account Member Of
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘accountmemberof’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' playbook did not return any results.
          3- The mapping rule for the 'Account Member Of' alert field was removed.
          4- A change was made to the 'outputs' value for the 'Account Member Of' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2140,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "282":
    id: "282"
    taskid: 9f9e47c6-83e6-4f43-838d-acc9cf5f0d44
    type: condition
    task:
      id: 9f9e47c6-83e6-4f43-838d-acc9cf5f0d44
      version: -1
      name: Verify Cloud Account ID
      description: Verify that the ‘cloudaccountid’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "283"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.cloudaccountid
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2530,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "283":
    id: "283"
    taskid: 230ec433-b766-425a-85e7-4eb6e175f4cc
    type: regular
    task:
      id: 230ec433-b766-425a-85e7-4eb6e175f4cc
      version: -1
      name: Verify Context Error - Cloud Account ID
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘cloudaccountid’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' playbook did not return any results.
          3- The mapping rule for the 'Cloud Account ID' alert field was removed.
          4- A change was made to the 'outputs' value for the 'Cloud Account ID' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2530,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "284":
    id: "284"
    taskid: 3ec6e664-6673-4094-8d56-61c8889f1702
    type: condition
    task:
      id: 3ec6e664-6673-4094-8d56-61c8889f1702
      version: -1
      name: Verify Account ID
      description: Verify that the ‘accountid’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "285"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.accountid
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2920,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "285":
    id: "285"
    taskid: fa5e13d0-a97c-4a46-83d8-af5f8c8a59db
    type: regular
    task:
      id: fa5e13d0-a97c-4a46-83d8-af5f8c8a59db
      version: -1
      name: Verify Context Error - Account ID
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘accountid’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' playbook did not return any results.
          3- The mapping rule for the 'Account ID' alert field was removed.
          4- A change was made to the 'outputs' value for the 'Account ID' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -2920,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "286":
    id: "286"
    taskid: 470abd04-e361-4a76-83b4-0e15e5ec1881
    type: condition
    task:
      id: 470abd04-e361-4a76-83b4-0e15e5ec1881
      version: -1
      name: Verify SAM Account Name
      description: Verify that the ‘sAMAccountName’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "287"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.samaccountname
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3310,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "287":
    id: "287"
    taskid: 5c91b5f9-0d87-48bc-8970-795ee0b4844e
    type: regular
    task:
      id: 5c91b5f9-0d87-48bc-8970-795ee0b4844e
      version: -1
      name: Verify Context Error - SAM Account Name
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘ sAMAccountName’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' playbook did not return any results.
          3- The mapping rule for the 'sAMAccountName' alert field was removed.
          4- A change was made to the 'outputs' value for the 'sAMAccountName' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3310,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "288":
    id: "288"
    taskid: 957cde49-c45b-4d5f-83b6-37da92e0507f
    type: condition
    task:
      id: 957cde49-c45b-4d5f-83b6-37da92e0507f
      version: -1
      name: Verify Account Status
      description: Verify that the ‘accountstatus’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "289"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.accountstatus
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3700,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "289":
    id: "289"
    taskid: 6cd7ddbb-c1e4-4461-8c88-0accbae15fff
    type: regular
    task:
      id: 6cd7ddbb-c1e4-4461-8c88-0accbae15fff
      version: -1
      name: Verify Context Error - Account Status
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘ accountstatus’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' playbook did not return any results.
          3- The mapping rule for the 'accountstatus' alert field was removed.
          4- A change was made to the 'outputs' value for the 'accountstatus' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -3700,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "290":
    id: "290"
    taskid: 59dc665d-029c-4daf-8c34-175d3f452dc4
    type: condition
    task:
      id: 59dc665d-029c-4daf-8c34-175d3f452dc4
      version: -1
      name: Verify Manager Email Address
      description: Verify that the ‘manageremailaddress’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "291"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: alert.manageremailaddress
            iscontext: true
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4090,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "291":
    id: "291"
    taskid: b31ed228-91c9-4968-89f8-9733e60cc9be
    type: regular
    task:
      id: b31ed228-91c9-4968-89f8-9733e60cc9be
      version: -1
      name: Verify Context Error - Manager Email Address
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘ manageremailaddress’ alert field was populated correctly. One of the following may be the cause:
          1- The 'SetAndHandleEmpty' script failed to execute in the 'Set Number of Related Alerts' task.
          2- The 'Account Enrichment - Generic v2.1' playbook did not return any results.
          3- The mapping rule for the 'manageremailaddress' alert field was removed.
          4- A change was made to the 'outputs' value for the 'manageremailaddress' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4090,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "292":
    id: "292"
    taskid: 14b6eb18-a528-455d-89b6-4ec6323f7f14
    type: regular
    task:
      id: 14b6eb18-a528-455d-89b6-4ec6323f7f14
      version: -1
      name: Set 'foundIncidents' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      key:
        simple: foundIncidents.severity
      value:
        simple: high
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1470,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "293":
    id: "293"
    taskid: 798d99b6-be9c-4ee9-89b3-6f53b0d502fc
    type: regular
    task:
      id: 798d99b6-be9c-4ee9-89b3-6f53b0d502fc
      version: -1
      name: Set 'event.auth_identity' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Core.OriginalAlert.event.auth_identity
      stringify:
        simple: "true"
      value:
        simple: test@test.com
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "294":
    id: "294"
    taskid: ef228948-dc93-4378-8fdc-cf3c3d3a27ed
    type: regular
    task:
      id: ef228948-dc93-4378-8fdc-cf3c3d3a27ed
      version: -1
      name: Set 'AzureFailLoginCount' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      key:
        simple: AzureFailLoginCount
      value:
        simple: "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 670,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "295":
    id: "295"
    taskid: 12677334-0737-46e2-8cd2-f4c354531078
    type: regular
    task:
      id: 12677334-0737-46e2-8cd2-f4c354531078
      version: -1
      name: Set 'NumOfOktaFailedLogon' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      key:
        simple: NumOfOktaFailedLogon
      value:
        simple: "5"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 260,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "296":
    id: "296"
    taskid: 7e2f62da-7b62-4365-8286-f7299eb3f031
    type: regular
    task:
      id: 7e2f62da-7b62-4365-8286-f7299eb3f031
      version: -1
      name: Set 'ActiveDirectory' to Context
      description: Set multiple keys/values to the context.
      scriptName: SetMultipleValues
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      keys:
        simple: mail,memberOf,sAMAccountName
      parent:
        simple: ActiveDirectory
      values:
        simple: test2@test.com,CN=Domain Admins,test
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -140,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "297":
    id: "297"
    taskid: 72efc2dc-171c-43d5-890a-67f59c2bbc95
    type: regular
    task:
      id: 72efc2dc-171c-43d5-890a-67f59c2bbc95
      version: -1
      name: Set 'MSGraphUser' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      key:
        simple: MSGraphUser.ID
      value:
        simple: "000000000001"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -550,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "298":
    id: "298"
    taskid: 13dc2f2d-b3bc-4b98-8c50-9407fa0280e6
    type: regular
    task:
      id: 13dc2f2d-b3bc-4b98-8c50-9407fa0280e6
      version: -1
      name: Set 'Account' to Context
      description: Set multiple keys/values to the context.
      scriptName: SetMultipleValues
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      keys:
        simple: ID,Status
      parent:
        simple: Account
      values:
        simple: 001,disable
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -950,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "299":
    id: "299"
    taskid: 25e4e034-88df-432c-8bc3-14b17070d047
    type: regular
    task:
      id: 25e4e034-88df-432c-8bc3-14b17070d047
      version: -1
      name: Set 'UserManagerEmail' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      key:
        simple: UserManagerEmail
      value:
        simple: ManagerEmail@test.com
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -1350,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "300":
    id: "300"
    taskid: fb766d2a-f445-4623-8979-abce3c55de74
    type: condition
    task:
      id: fb766d2a-f445-4623-8979-abce3c55de74
      version: -1
      name: Verify Verdict
      description: Verify that the ‘ Verdict’ alert field was populated correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "301"
      "yes":
      - "305"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: alert.verdict
            iscontext: true
          right:
            value:
              simple: Malicious
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4480,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "301":
    id: "301"
    taskid: bc770bbe-a44a-486f-863c-3755c6ec6dc0
    type: regular
    task:
      id: bc770bbe-a44a-486f-863c-3755c6ec6dc0
      version: -1
      name: Verify Context Error - Verdict
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The ‘ Verdict’ alert field was populated correctly. One of the following may be the cause:
          1- The 'Set' script failed to execute in the 'Set Alert Verdict' task.
          2- The mapping rule for the 'Verdict' alert field was removed.
          3- A change was made to the 'outputs' value for the 'Verdict' alert field mapping rule.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": -4480,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "302":
    id: "302"
    taskid: 105c527c-ce30-49d7-85f1-8afec2b77171
    type: condition
    task:
      id: 105c527c-ce30-49d7-85f1-8afec2b77171
      version: -1
      name: Verify Verdict
      description: Verify that the ‘Verdict’ context key was extracted correctly.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "303"
      "yes":
      - "256"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isEqualString
          left:
            value:
              simple: Verdict
            iscontext: true
          right:
            value:
              simple: Malicious
          ignorecase: true
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 1550
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "303":
    id: "303"
    taskid: be490050-5919-45af-873d-6c7f3274d35e
    type: regular
    task:
      id: be490050-5919-45af-873d-6c7f3274d35e
      version: -1
      name: Verify Context Error - Verdict
      description: Prints an error entry with a given message
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: |-
          The 'Verdict' context key was not extracted properly. One of the following may be the cause:
          1- The 'Set' script failed to execute in the 'Set Alert Verdict' task.
          2- The 'key' input configuration was changed for the 'Set' automation used in the 'Set Alert Verdict' task.
          3- The 'value' input configuration was changed for the 'Set' automation used in the 'Set Alert Verdict' task.
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1490,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "304":
    id: "304"
    taskid: 2d1a3bfd-e8b5-4d08-8e7f-770692ab2654
    type: title
    task:
      id: 2d1a3bfd-e8b5-4d08-8e7f-770692ab2654
      version: -1
      name: Set Information to Context
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "265"
      - "268"
      - "292"
      - "294"
      - "295"
      - "296"
      - "297"
      - "298"
      - "299"
      - "308"
      - "293"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 130
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "305":
    id: "305"
    taskid: 0b41783a-1bf3-47a8-88c6-c6e35db7a6fe
    type: title
    task:
      id: 0b41783a-1bf3-47a8-88c6-c6e35db7a6fe
      version: -1
      name: Done Verifying Alert Fields
      type: title
      iscommand: false
      brand: ""
      description: ''
    nexttasks:
      '#none#':
      - "306"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 230,
          "y": 1755
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "306":
    id: "306"
    taskid: c0a0fcfe-4f1a-4136-8bb9-517a0d31b500
    type: title
    task:
      id: c0a0fcfe-4f1a-4136-8bb9-517a0d31b500
      version: -1
      name: Done
      type: title
      iscommand: false
      brand: ""
      description: ''
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1910
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "308":
    id: "308"
    taskid: b28cb016-33d4-4eb5-82d4-b3218ddab6ae
    type: regular
    task:
      id: b28cb016-33d4-4eb5-82d4-b3218ddab6ae
      version: -1
      name: Set 'RiskyUser.risk_level' to Context
      description: |-
        Set a value in context under the key you entered. If no value is entered, the script doesn't do anything.

        This automation runs using the default Limited User role, unless you explicitly change the permissions.
        For more information, see the section about permissions here:
        https://docs-cortex.paloaltonetworks.com/r/Cortex-XSOAR/6.10/Cortex-XSOAR-Administrator-Guide/Automations
      scriptName: SetAndHandleEmpty
      type: regular
      iscommand: false
      brand: Builtin
    nexttasks:
      '#none#':
      - "266"
    scriptarguments:
      append:
        simple: "true"
      key:
        simple: Core.RiskyUser.risk_level
      stringify:
        simple: "true"
      value:
        simple: Medium
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 2660,
          "y": 270
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "309":
    id: "309"
    taskid: bd516d72-bab1-42fc-8afa-ca24cd489bef
    type: regular
    task:
      id: bd516d72-bab1-42fc-8afa-ca24cd489bef
      version: -1
      name: Get Users Error - No Available AD Users
      description: Prints an error entry with a given message.
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: "No available users were found. \nThis may indicate the following:\n1- The 'ad-get-user' script failed to execute.\n2- The 'ad-get-user' script did not return any results.\n3- The 'name' input configuration was changed for the 'ad-get-user' automation used in the 'Get Available Users - AD' test playbook task."
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1070,
          "y": 90
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "310":
    id: "310"
    taskid: c42a28fe-f030-46ca-8482-ff8d8996d974
    type: regular
    task:
      id: c42a28fe-f030-46ca-8482-ff8d8996d974
      version: -1
      name: Get Available Users - Okta
      description: Lists users in your organization.
      script: '|||okta-list-users'
      type: regular
      iscommand: true
      brand: ""
    nexttasks:
      '#none#':
      - "311"
    scriptarguments:
      ignore-outputs:
        simple: "false"
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 600
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "311":
    id: "311"
    taskid: 88b347b6-06b6-454b-84cd-59b0d5790c6c
    type: condition
    task:
      id: 88b347b6-06b6-454b-84cd-59b0d5790c6c
      version: -1
      name: Okta Users Retrieved?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "312"
      "yes":
      - "313"
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: isNotEmpty
          left:
            value:
              simple: Account.ID
            iscontext: true
          right:
            value: {}
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 760
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "312":
    id: "312"
    taskid: 0fb52403-f709-48fb-8095-f1653bb5a020
    type: regular
    task:
      id: 0fb52403-f709-48fb-8095-f1653bb5a020
      version: -1
      name: Get Users Error - No Available Okta Users
      description: Prints an error entry with a given message.
      scriptName: PrintErrorEntry
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      message:
        simple: "No available users were found. \nThis may indicate the following:\n1- The 'okta-list-users' script failed to execute.\n2- The 'okta-list-users' script did not return any results."
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 1090,
          "y": 940
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "313":
    id: "313"
    taskid: 5e343d1c-3e42-48dd-8c8c-fb39dcf87d54
    type: regular
    task:
      id: 5e343d1c-3e42-48dd-8c8c-fb39dcf87d54
      version: -1
      name: Set 'Username' To Alert Field
      description: commands.local.cmd.set.incident
      script: Builtin|||setAlert
      type: regular
      iscommand: true
      brand: Builtin
    nexttasks:
      '#none#':
      - "314"
    scriptarguments:
      username:
        complex:
          root: Account
          filters:
          - - operator: containsGeneral
              left:
                value:
                  simple: Account.DisplayName
                iscontext: true
              right:
                value:
                  simple: test
              ignorecase: true
          accessor: Username
          transformers:
          - operator: FirstArrayElement
    separatecontext: false
    continueonerrortype: ""
    view: |-
      {
        "position": {
          "x": 460,
          "y": 930
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
  "314":
    id: "314"
    taskid: 29dbf83b-c384-41c1-866d-a2df8afc7dfa
    type: playbook
    task:
      id: 29dbf83b-c384-41c1-866d-a2df8afc7dfa
      version: -1
      name: Identity Analytics - Alert Handling - Okta
      description: |-
        The `Identity Analytics - Alert Handling` playbook is designed to handle Identity Analytics alerts and executes the following:

        Analysis:
        - Enriches the IP and the account, providing additional context and information about these indicators.

        Verdict:
        - Determines the appropriate verdict based on the data collected from the enrichment phase.

        Investigation:
        - Checks for related XDR alerts to the user by Mitre tactics to identify malicious activity.
        - Checks for specific arguments for malicious usage from Okta using the 'Okta User Investigation' sub-playbook.
        - Checks for specific arguments for malicious usage from Azure using the 'Azure User Investigation' sub-playbook.

        Verdict Handling:
        - Handles malicious alerts by initiating appropriate response actions, including blocking malicious IP and revoking or clearing user's sessions.
        - Handles non-malicious alerts identified during the investigation.
      playbookName: Identity Analytics - Alert Handling
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    scriptarguments:
      AutoContainment:
        simple: "False"
      AutoRemediation:
        simple: "False"
      AzureMfaFailedLogonThreshold:
        simple: "1"
      ClearUserSessions:
        simple: "False"
      FailedLogonThreshold:
        simple: "1"
      IAMRemediationType:
        simple: Revoke
      OktaSuspiciousEventsThreshold:
        simple: "1"
      RelatedAlertsThreshold:
        simple: "1"
      UserContainment:
        simple: "False"
    separatecontext: false
    continueonerrortype: ""
    loop:
      iscommand: false
      exitCondition: ""
      wait: 1
      max: 100
    view: |-
      {
        "position": {
          "x": 460,
          "y": 1090
        }
      }
    note: false
    timertriggers: []
    ignoreworker: false
    skipunavailable: false
    quietmode: 0
    isoversize: false
    isautoswitchedtoquietmode: false
view: |-
  {
    "linkLabelsPosition": {
      "302_256_yes": 0.17,
      "70_256_yes": 0.11
    },
    "paper": {
      "dimensions": {
        "height": 2505,
        "width": 7520,
        "x": -4480,
        "y": -530
      }
    }
  }
inputs: []
outputs: []
tests:
- No tests (auto formatted)
fromversion: 6.6.0
marketplaces:
- marketplacev2
